# ğŸ“¦ OPaaS - Linux ç¦»çº¿åŒ…å·¥åœº (Linux Offline Package Factory)

**OPaaS** æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„ Linux ç¦»çº¿è½¯ä»¶åŠå…¶å…¨é‡ä¾èµ–ä¸‹è½½å¹³å°ã€‚

å®ƒä¸“ä¸ºè§£å†³**å†…ç½‘ç¯å¢ƒï¼ˆAir-gappedï¼‰**æœåŠ¡å™¨å®‰è£…è½¯ä»¶æ—¶çš„â€œä¾èµ–åœ°ç‹±â€é—®é¢˜è€Œè®¾è®¡ã€‚é€šè¿‡ Docker å®¹å™¨éš”ç¦»æŠ€æœ¯ï¼Œå®ƒèƒ½åœ¨äº‘ç«¯çº¯å‡€ç¯å¢ƒä¸­è‡ªåŠ¨è§£æå¹¶ä¸‹è½½è½¯ä»¶åŠå…¶æ‰€æœ‰ä¾èµ–é“¾ï¼Œå¹¶æ‰“åŒ…ç”Ÿæˆä¸€é”®å®‰è£…è„šæœ¬ã€‚

ğŸ”¥ **ç‰¹åˆ«ä¼˜åŒ–**ï¼šæœ¬é¡¹ç›®å·²é€‚é… **Oracle Cloud ARM (Ampere)** æ¶æ„æœåŠ¡å™¨ï¼Œå¹¶æ”¯æŒ**è·¨æ¶æ„ä¸‹è½½**ï¼ˆå³åœ¨ ARM æœåŠ¡å™¨ä¸Šä¸º x86_64 æœºå™¨ä¸‹è½½è½¯ä»¶åŒ…ï¼Œåä¹‹äº¦ç„¶ï¼‰ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

* **ğŸŒ è·¨æ¶æ„æ”¯æŒ (Cross-Arch)**ï¼šæ”¯æŒåœ¨ ARM64 å®¿ä¸»æœºä¸Šä¸‹è½½ AMD64 (x86_64) çš„è½¯ä»¶åŒ…ï¼Œå®Œç¾é€‚é… Oracle Cloud Free Tierã€‚
* **ğŸ›¡ï¸ ç¯å¢ƒéš”ç¦»**ï¼šåŸºäº Docker å®¹å™¨æ‰§è¡Œä¸‹è½½ä»»åŠ¡ï¼Œåˆ©ç”¨ `apt` çš„ `--download-only` ç‰¹æ€§ï¼Œç¡®ä¿ä¾èµ–è®¡ç®—å‡†ç¡®ä¸”ä¸æ±¡æŸ“å®¿ä¸»æœºã€‚
* **ğŸ§ å¤šå‘è¡Œç‰ˆæ”¯æŒ**ï¼šç›®å‰æ”¯æŒ Ubuntu 24.04 LTS, Debian 11, Debian 12ã€‚
* **âš¡ è‡ªåŠ¨åŒ–è„šæœ¬**ï¼šè‡ªåŠ¨ç”Ÿæˆ `install.sh` è„šæœ¬ï¼Œç¦»çº¿ç¯å¢ƒåªéœ€æ‰§è¡Œä¸€ä¸ªå‘½ä»¤å³å¯å®Œæˆå®‰è£… + ä¾èµ–é…ç½® + æœåŠ¡å¯åŠ¨ã€‚
* **ğŸ“Š å¯è§†åŒ–ç•Œé¢**ï¼šé›†æˆ Vue 3 + Tailwind CSS çš„å•æ–‡ä»¶å‰ç«¯ï¼Œæ“ä½œç®€å•ç›´è§‚ã€‚
* **ğŸ“ æ—¥å¿—æŒä¹…åŒ–**ï¼šå®Œæ•´çš„ä»»åŠ¡æ—¥å¿—è®°å½•ä¸è½®è½¬æœºåˆ¶ï¼Œæ–¹ä¾¿è¿ç»´æ’æŸ¥ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TD
    User[ç”¨æˆ· (Browser)] -->|HTTP POST| Web[Web æœåŠ¡ (FastAPI)]
    Web -->|æŒ‚è½½ Socket| DockerDaemon[å®¿ä¸»æœº Docker å®ˆæŠ¤è¿›ç¨‹]
    DockerDaemon -->|å¯åŠ¨| Worker[ä¸‹è½½å™¨å®¹å™¨ (Ubuntu/Debian)]
    
    subgraph "ä¸‹è½½å™¨å®¹å™¨ (Ephemeral)"
        Config[é…ç½® APT æº & æ¶æ„]
        Apt[apt-get install --download-only]
        Output[è¾“å‡º .deb æ–‡ä»¶]
    end
    
    Worker -- æŒ‚è½½å· --> HostDisk[å®¿ä¸»æœºç£ç›˜ /data]
    Web -- è¯»å– --> HostDisk
    Web -- æ‰“åŒ… .tar.gz --> User
    ğŸš€ éƒ¨ç½²æŒ‡å—
ç¯å¢ƒè¦æ±‚
Docker & Docker Compose

Linux å®¿ä¸»æœº (æ¨è Ubuntu/Debianï¼Œæ”¯æŒ ARM64 æˆ– AMD64)

ç½‘ç»œï¼šå®¿ä¸»æœºéœ€è¦èƒ½è®¿é—®å…¬ç½‘ï¼ˆç”¨äºæ‹‰å– Docker é•œåƒå’Œè½¯ä»¶æºï¼‰

1. å…‹éš†é¡¹ç›®
Bash

git clone [https://github.com/your-username/opaas.git](https://github.com/your-username/opaas.git)
cd opaas
2. åˆå§‹åŒ–ä¸‹è½½å™¨é•œåƒ (é‡è¦)
ç”±äºé¡¹ç›®é€šè¿‡ Docker è°ƒç”¨ Dockerï¼ˆDind æ¨¡å¼ï¼‰ï¼Œéœ€è¦é¢„å…ˆåœ¨å®¿ä¸»æœºæ„å»ºå¥½ä¸‹è½½å™¨åŸºç¡€é•œåƒã€‚

æ³¨æ„ï¼šè„šæœ¬ä¼šè‡ªåŠ¨è¯†åˆ«å®¿ä¸»æœºæ¶æ„ã€‚å³ä½¿åœ¨ Oracle ARM æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿèƒ½æ„å»ºå‡ºæ”¯æŒä¸‹è½½ x86 åŒ…çš„é•œåƒã€‚

Bash

chmod +x build_images.sh builder/entrypoint.sh
./build_images.sh
3. å¯åŠ¨æœåŠ¡
Bash

docker-compose up -d --build
4. è®¿é—®æœåŠ¡
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://<æœåŠ¡å™¨IP>:8000

ğŸ“– ä½¿ç”¨è¯´æ˜
é€‰æ‹©ç›®æ ‡ç³»ç»Ÿï¼šä¾‹å¦‚ Ubuntu 24.04ã€‚

é€‰æ‹©ç›®æ ‡æ¶æ„ (å…³é”®)ï¼š

å¦‚æœè¦ç»™æ™®é€š PC æˆ–ä¼ ç»ŸæœåŠ¡å™¨ç”¨ï¼Œè¯·å‹¾é€‰ x86_64 (amd64)ã€‚

å¦‚æœè¦ç»™æ ‘è“æ´¾æˆ– ARM æœåŠ¡å™¨ç”¨ï¼Œè¯·å‹¾é€‰ aarch64 (arm64)ã€‚

é€‰æ‹©è½¯ä»¶åŒ…ï¼šå‹¾é€‰é¢„è®¾åˆ—è¡¨ï¼ˆå¦‚ Docker, SSH, Vimï¼‰æˆ–æ‰‹åŠ¨è¾“å…¥åŒ…åï¼ˆå¦‚ htop jq nginxï¼‰ã€‚

æ„å»ºï¼šç‚¹å‡»å¼€å§‹ï¼Œåå°å°†å¯åŠ¨éš”ç¦»å®¹å™¨è¿›è¡Œä¸‹è½½ã€‚

ä¸‹è½½ & ç¦»çº¿å®‰è£…ï¼š

ç‚¹å‡»ä¸‹è½½ç”Ÿæˆçš„ .tar.gz åŒ…ã€‚

ä¸Šä¼ åˆ°ç¦»çº¿æœåŠ¡å™¨å¹¶è§£å‹ï¼štar -xzvf offline_pkg_xxxx.tar.gz

è¿›å…¥ç›®å½•å¹¶è¿è¡Œå®‰è£…è„šæœ¬ï¼šsudo bash install.sh

ğŸ“‚ ç›®å½•ç»“æ„
Plaintext

.
â”œâ”€â”€ backend/                # Web åç«¯ (FastAPI)
â”‚   â”œâ”€â”€ main.py             # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ Dockerfile          # Web æœåŠ¡é•œåƒæ„å»º
â”‚   â”œâ”€â”€ requirements.txt    # Python ä¾èµ–
â”‚   â”œâ”€â”€ templates/          # Jinja2 è„šæœ¬æ¨¡æ¿ (ç”Ÿæˆ install.sh)
â”‚   â””â”€â”€ static/             # Vue3 å‰ç«¯é¡µé¢ (å•æ–‡ä»¶)
â”œâ”€â”€ builder/                # ä¸‹è½½å™¨é•œåƒæ„å»ºæ–‡ä»¶
â”‚   â”œâ”€â”€ Dockerfile          # åŸºç¡€ç³»ç»Ÿé•œåƒ
â”‚   â””â”€â”€ entrypoint.sh       # æ ¸å¿ƒä¸‹è½½é€»è¾‘ (å«è·¨æ¶æ„å¤„ç†ã€æ¢æº)
â”œâ”€â”€ logs/                   # è¿è¡Œæ—¥å¿— (è‡ªåŠ¨æŒ‚è½½)
â”œâ”€â”€ data/                   # ä¸´æ—¶ä»»åŠ¡æ•°æ® (è‡ªåŠ¨æŒ‚è½½)
â”œâ”€â”€ docker-compose.yml      # æœåŠ¡ç¼–æ’
â””â”€â”€ build_images.sh         # åˆå§‹åŒ–æ„å»ºè„šæœ¬
ğŸ› ï¸ æŠ€æœ¯æ ˆ
Backend: Python, FastAPI, Docker SDK for Python, Jinja2

Frontend: Vue.js 3, Tailwind CSS (CDN å¼•å…¥)

Container: Docker, Multi-stage builds

System: Linux Shell (Bash), APT/DPKG, dpkg-architecture

âš ï¸ æ³¨æ„äº‹é¡¹
ç£ç›˜ç©ºé—´ï¼šä¸‹è½½ä»»åŠ¡ä¼šäº§ç”Ÿå¤§é‡ä¸´æ—¶æ–‡ä»¶ã€‚è™½ç„¶ç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç†æˆåŠŸçš„ä»»åŠ¡ç›®å½•ï¼Œä½† data/temp_tasks å’Œ logs/ ç›®å½•å»ºè®®å®šæœŸæ£€æŸ¥ã€‚

ç½‘ç»œé€Ÿåº¦ï¼šä¸‹è½½é€Ÿåº¦å–å†³äºå®¿ä¸»æœºè¿æ¥å®˜æ–¹æºï¼ˆarchive.ubuntu.com / deb.debian.orgï¼‰çš„é€Ÿåº¦ã€‚

å®‰å…¨ç»„ï¼šOracle Cloud é»˜è®¤é˜²ç«å¢™è¾ƒä¸¥æ ¼ï¼Œè¯·ç¡®ä¿åœ¨æ§åˆ¶å°æ”¾è¡Œ TCP 8000 ç«¯å£ï¼Œå¹¶åœ¨æœåŠ¡å™¨å†…éƒ¨ iptables/ufw æ”¾è¡Œè¯¥ç«¯å£ã€‚